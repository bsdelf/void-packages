# Template file for 'netatalk'
pkgname=netatalk
version=3.1.15
revision=1
build_style=gnu-configure
hostmakedepends="autoconf pkg-config"
makedepends="acl-devel pam-devel libgcrypt-devel db-devel libevent-devel avahi-libs-devel openssl-devel dbus-glib-devel"
depends="python3"
short_desc="Open Source fileserver that implements the Apple Filing Protocol (AFP)"
maintainer="Yanhui Shen <shen.elf@gmail.com>"
license="GPL-2.0-only"
homepage="https://github.com/Netatalk/netatalk"
distfiles="https://github.com/Netatalk/netatalk/releases/download/netatalk-${version//./-}/netatalk-${version}.tar.bz2"
checksum=d8d4a5cc0fd86b0d90e017d64c1f4623e8cdbfbda570fc423ade1151a93d19f5
python_version=3

conf_files="
 /etc/dbus-1/system.d/netatalk-dbus.conf
 /etc/extmap.conf
 /etc/afp.conf"

if [ "$CROSS_BUILD" ]; then
	configure_args+=" --with-bdb=${XBPS_CROSS_BASE}"
fi

post_install() {
	vsv netatalk
	vsconf ${DESTDIR}/etc/dbus-session.conf
	rm ${DESTDIR}/etc/dbus-session.conf
}

netatalk-devel_package() {
	depends="${sourcepkg}>=${version}_${reversion}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/bin/netatalk-config
		vmove usr/include
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
		vmove "usr/lib/netatalk/*.a"
		vmove usr/share/aclocal
		vmove usr/share/man/man1/netatalk-config.1
	}
}
